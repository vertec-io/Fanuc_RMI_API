# v0.4.0 Release Summary

**Release Date**: 2025-11-25  
**Status**: ‚úÖ Ready for Release

---

## Overview

Version 0.4.0 is a major release that introduces the correlation ID system and fixes critical precision issues with position data. This release contains **breaking changes** that require downstream applications to update their code.

---

## What Changed

### 1. Version Numbers Updated

- ‚úÖ `fanuc_rmi/Cargo.toml`: `0.3.0` ‚Üí `0.4.0`
- ‚úÖ `readme.md`: Updated to reflect v0.4.0
- ‚úÖ `docs/README.md`: Updated documentation links
- ‚úÖ `docs/releases/README.md`: Added v0.4.0 entry

### 2. Release Documentation Created

- ‚úÖ **[docs/releases/RELEASE_NOTES_v0.4.0.md](releases/RELEASE_NOTES_v0.4.0.md)** - Comprehensive release notes with:
  - Breaking changes section
  - Migration guide
  - New features
  - Bug fixes
  - Full changelog
  - Upgrade instructions

### 3. Documentation Updated

- ‚úÖ Main README updated with v0.4.0 breaking changes warning
- ‚úÖ Release notes index updated
- ‚úÖ Version history table updated

---

## Breaking Changes Summary

### üí• Position Data Type Change (f32 ‚Üí f64)

**Files Modified**:
- `fanuc_rmi/src/lib.rs` - Position and FrameData structs

**Impact**: All code using Position or FrameData needs to remove `as f32` casts

**Migration**:
```rust
// Before
let dist = distance as f32;

// After
let dist = distance;  // Already f64
```

---

### üí• Correlation ID System

**Files Modified**:
- `fanuc_rmi/src/drivers/driver.rs` - send_command() return type
- `fanuc_rmi/src/packets/instruction.rs` - SentInstructionInfo struct

**Impact**: Code calling `send_command()` needs to use new helper functions

**Migration**:
```rust
// Before (BROKEN - returns 0)
let seq_id = driver.send_command(packet, priority)?;

// After (Option 1 - Recommended)
let seq_id = driver.send_and_wait_for_completion(packet, priority).await?;

// After (Option 2 - Flexible)
let correlation_id = driver.send_command(packet, priority)?;
let seq_id = driver.wait_on_correlation_completion(correlation_id).await?;
```

---

## New Features

### ‚ú® Correlation ID System

- `send_and_wait_for_completion()` - Send and wait in one call
- `wait_on_correlation_completion()` - Wait for correlation ID to be sent
- `wait_on_instruction_completion()` - Wait for sequence ID to complete
- `subscribe_sent_instructions()` - Subscribe to sent instruction notifications

### ‚ú® High-Precision Position Data

- All position fields now use f64 (15-16 decimal digits)
- Perfect JSON roundtrip accuracy
- UI displays exact values matching FANUC Teach Pendant

---

## Bug Fixes

### üêõ Invalid Sequence ID Errors (RMIT-029)

Fixed three root causes:
1. Web app sending random sequence IDs
2. Priority queue reordering after sequence ID assignment
3. Missing NextSequenceID field

### üêõ Position Display Precision Loss

Fixed f32 precision loss causing UI to show different values than Teach Pendant

### üêõ Web App Build Issues

Fixed trunk build errors by consolidating entry points

---

## Migration Resources

Comprehensive documentation for downstream apps:

1. **[Release Notes](releases/RELEASE_NOTES_v0.4.0.md)** - Complete release notes
2. **[Sequence ID Migration Guide](SEQUENCE_ID_MIGRATION_GUIDE.md)** - Detailed migration instructions
3. **[Correlation ID Examples](examples/correlation_id_usage.rs)** - Working code examples
4. **[Position Precision Fix](POSITION_PRECISION_FIX.md)** - f32‚Üíf64 details

---

## Testing Status

All tests passing:
- ‚úÖ `cargo check -p fanuc_rmi` - PASSED
- ‚úÖ `cargo build -p fanuc_rmi` - PASSED
- ‚úÖ `cargo test -p fanuc_rmi` - PASSED
- ‚úÖ `cargo check -p web_server` - PASSED
- ‚úÖ Position precision tests - PASSED

---

## Next Steps for Release

### 1. Review and Test

- [ ] Review release notes for accuracy
- [ ] Test with real FANUC robot
- [ ] Test all examples
- [ ] Test web app end-to-end

### 2. Git Operations

```bash
# Commit all changes
git add .
git commit -m "Release v0.4.0: Correlation ID system and position precision fix"

# Tag the release
git tag -a v0.4.0 -m "Release v0.4.0"

# Push to remote
git push origin main
git push origin v0.4.0
```

### 3. Notify Downstream Apps

Notify teams using this library (e.g., Meteorite project):
- Point them to [Sequence ID Migration Guide](SEQUENCE_ID_MIGRATION_GUIDE.md)
- Highlight breaking changes
- Provide migration timeline

### 4. Future: Publish to crates.io (Optional)

When ready for public release:
```bash
cargo publish -p fanuc_rmi_macros
cargo publish -p fanuc_rmi
```

---

## Downstream Impact

### Meteorite Project

The Meteorite project (`/home/apino/dev/meteorite`) uses sequence ID tracking in their ECS implementation. They will need to:

1. Update `Cargo.toml`: `fanuc_rmi = "0.4"`
2. Replace `send_command()` calls with `send_and_wait_for_completion()`
3. Remove any `as f32` casts when working with Position data

See [Sequence ID Migration Guide](SEQUENCE_ID_MIGRATION_GUIDE.md) for their exact use case.

---

## Files Changed in This Release

### Core Library
- `fanuc_rmi/Cargo.toml` - Version bump
- `fanuc_rmi/src/lib.rs` - Position/FrameData f32‚Üíf64
- `fanuc_rmi/src/drivers/driver.rs` - Correlation ID system
- `fanuc_rmi/src/packets/instruction.rs` - SentInstructionInfo

### Examples
- `example/src/bin/jog_client.rs` - Removed f32 casts
- `example/src/bin/jog_client_tui.rs` - Removed f32 casts

### Web App
- `web_app/src/components/jog_controls.rs` - f32‚Üíf64
- `web_app/src/lib.rs` - wasm_bindgen entry point
- `web_app/index.html` - trunk config
- `web_app/src/main.rs` - DELETED

### Tests
- `fanuc_rmi/tests/position_precision_test.rs` - NEW

### Documentation
- `readme.md` - Updated for v0.4.0
- `docs/README.md` - Updated links
- `docs/releases/README.md` - Added v0.4.0
- `docs/releases/RELEASE_NOTES_v0.4.0.md` - NEW
- `docs/SEQUENCE_ID_MIGRATION_GUIDE.md` - Created earlier
- `docs/CORRELATION_ID_IMPLEMENTATION_SUMMARY.md` - Created earlier
- `docs/POSITION_PRECISION_FIX.md` - Created earlier
- `docs/POSITION_PRECISION_SUMMARY.md` - Created earlier
- `docs/examples/correlation_id_usage.rs` - Created earlier

---

## Summary

‚úÖ **Version 0.4.0 is ready for release!**

This release fixes critical bugs and improves precision, but requires downstream apps to migrate their code. Comprehensive documentation has been provided to make the migration smooth.


